<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Management - DSS</title>
    <link rel="stylesheet" th:href="@{/css/neo-dashboard.css}" />
    <style>
        .search-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        
        .search-field {
            display: flex;
            flex-direction: column;
        }
        
        .search-field label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
            font-size: 13px;
        }
        
        .search-field input,
        .search-field select {
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .search-field input:focus,
        .search-field select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .search-info {
            background: #e7f3ff;
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">üìã DSS - Invoice Management</div>
        <div class="navbar-actions">
            <a href="/sales/dashboard" class="btn-back">‚Üê Back to Sales Dashboard</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="welcome-section">
            <h1>üìä Invoice Management System</h1>
            <p>Search, filter, and manage all invoice records</p>
        </div>
        
        <!-- Stats Cards -->
        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-card-icon">üìÑ</div>
                <div class="stat-card-title">Total Records</div>
                <div class="stat-card-value" th:text="${totalItems}">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-icon">üìñ</div>
                <div class="stat-card-title">Current Page</div>
                <div class="stat-card-value" th:text="${currentPage + 1} + ' / ' + ${totalPages}">1 / 1</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-icon">üìä</div>
                <div class="stat-card-title">Per Page</div>
                <div class="stat-card-value" th:text="${pageSize}">25</div>
            </div>
        </div>
        
        <!-- Search Form -->
        <div class="search-container">
            <form class="search-form" method="get" action="/invoices">
                <div class="search-field">
                    <label for="invoiceNo">üî¢ Invoice No</label>
                    <input type="text" id="invoiceNo" name="invoiceNo" 
                           placeholder="e.g., 536365" th:value="${param.invoiceNo}">
                </div>
                
                <div class="search-field">
                    <label for="stockCode">üì¶ Stock Code</label>
                    <input type="text" id="stockCode" name="stockCode" 
                           placeholder="e.g., 85123A" th:value="${param.stockCode}">
                </div>
                
                <div class="search-field">
                    <label for="description">üìù Description</label>
                    <input type="text" id="description" name="description" 
                           placeholder="Search in description" th:value="${param.description}">
                </div>
                
                <div class="search-field">
                    <label for="customerId">üë§ Customer ID</label>
                    <input type="text" id="customerId" name="customerId" 
                           placeholder="e.g., 17850" th:value="${param.customerId}">
                </div>
                
                <div class="search-field">
                    <label for="country">üåç Country</label>
                    <input type="text" id="country" name="country" 
                           placeholder="e.g., United Kingdom" th:value="${param.country}">
                </div>
                
                <div class="search-field">
                    <label for="pageSize">üìÑ Records per page</label>
                    <select id="pageSize" name="size">
                        <option value="10" th:selected="${pageSize == 10}">10</option>
                        <option value="25" th:selected="${pageSize == 25}">25</option>
                        <option value="50" th:selected="${pageSize == 50}">50</option>
                        <option value="100" th:selected="${pageSize == 100}">100</option>
                    </select>
                </div>
                
                <div class="search-buttons">
                    <button type="submit" class="btn-primary">üîç Search</button>
                    <a href="/invoices" class="btn-secondary">üîÑ Reset</a>
                </div>
            </form>
        </div>
        
        <!-- Search Info -->
        <div class="search-info" th:if="${param.invoiceNo != null or param.stockCode != null or param.description != null or param.customerId != null or param.country != null}">
            <strong>Search Results:</strong> Found <span th:text="${totalItems}">0</span> matching records
        </div>
        
        <!-- Invoices Table -->
        <div class="content-card">
            <div class="table-container" th:if="${!invoices.isEmpty()}">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Invoice No</th>
                            <th>Stock Code</th>
                            <th>Description</th>
                            <th class="text-right">Quantity</th>
                            <th>Date</th>
                            <th class="text-right">Price</th>
                            <th>Customer ID</th>
                            <th>Country</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="invoice : ${invoices}">
                            <td><code class="code-pill" th:text="${invoice.invoiceNo}">536365</code></td>
                            <td><code class="code-pill" th:text="${invoice.stockCode}">85123A</code></td>
                            <td th:text="${invoice.description}">WHITE HANGING HEART</td>
                            <td class="text-right" th:text="${invoice.quantity}">6</td>
                            <td th:text="${invoice.invoiceDate}">2010-12-01 08:26</td>
                            <td class="text-right"><strong th:text="'$' + ${#numbers.formatDecimal(invoice.unitPrice, 1, 2)}">$2.55</strong></td>
                            <td th:text="${invoice.customerId}">17850</td>
                            <td th:text="${invoice.country}">United Kingdom</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="no-data" th:if="${invoices.isEmpty()}">
                <p>üì≠ No invoices found</p>
                <p style="font-size: 14px; margin-top: 10px;">Try adjusting your search criteria</p>
            </div>
        </div>
        
        <!-- Pagination -->
        <div class="pagination" th:if="${totalPages > 1}">
            <a th:href="@{/invoices(page=${currentPage > 0 ? currentPage - 1 : 0}, size=${pageSize}, invoiceNo=${param.invoiceNo}, stockCode=${param.stockCode}, description=${param.description}, customerId=${param.customerId}, country=${param.country})}"
               th:class="${currentPage == 0} ? 'disabled' : ''">
                ‚Üê Previous
            </a>
            
            <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                  th:if="${i >= currentPage - 2 and i <= currentPage + 2}">
                <a th:href="@{/invoices(page=${i}, size=${pageSize}, invoiceNo=${param.invoiceNo}, stockCode=${param.stockCode}, description=${param.description}, customerId=${param.customerId}, country=${param.country})}"
                   th:text="${i + 1}"
                   th:class="${i == currentPage} ? 'current' : ''">
                    1
                </a>
            </span>
            
            <a th:href="@{/invoices(page=${currentPage < totalPages - 1 ? currentPage + 1 : totalPages - 1}, size=${pageSize}, invoiceNo=${param.invoiceNo}, stockCode=${param.stockCode}, description=${param.description}, customerId=${param.customerId}, country=${param.country})}"
               th:class="${currentPage >= totalPages - 1} ? 'disabled' : ''">
                Next ‚Üí
            </a>
        </div>
    </div>
</body>
</html>
